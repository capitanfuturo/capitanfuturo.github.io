{"componentChunkName":"component---src-templates-blog-post-js","path":"/2024-06-01-android-emulator/","result":{"data":{"site":{"siteMetadata":{"title":"Capitanfuturo"}},"markdownRemark":{"id":"a593d3bb-4d74-51cc-b7f3-cd818a301b6d","excerpt":"💾 Premessa A lavoro ho avuto la necessità di fornire un emulatore Andorid ai Project Manager dei team di sviluppo. Ne ho provati diversi ma tutti i più…","html":"<h2>💾 Premessa</h2>\n<p>A lavoro ho avuto la necessità di fornire un emulatore Andorid ai Project Manager dei team di sviluppo. Ne ho provati diversi ma tutti i più promettenti oltre a non essere open source spesso si presentano con molte pubblicità e il più delle volte vengono considerati dei malware o virus dai sistemi interni dell’ufficio. Mi sono quindi deciso di provare a costruire un emulatore come quello di Android Studio senza dover installare tutta l’IDE e dover applicare le varie configurazioni iniziali necessarie per eseguirlo.</p>\n<h2>💥 Obiettivo</h2>\n<p>Costruire un emulatore Android senza Android Studio.</p>\n<h2>Script powershell</h2>\n<p>Purtroppo in ufficio abbiamo tutta l’infrastruttura basata su sistemi Microsoft, lo so sono un inguaribile romantico e continuo a credere prima o poi un desktop open source possa sostituire il dominio di prodotti closed source, d’altronde anche il software che vendiamo non è open 😄. Ma passiamo direttamente allo script che è disponibile come <a href=\"https://gist.github.com/capitanfuturo/cf3cd49f0108a12d0345f1d53d464484\">gist</a> ma che riporto anche qui sotto a blocchi.</p>\n<p><strong>Nota</strong>: Lo script crea una cartella output di fianco allo script nella quale mette tutto l’occorente.</p>\n<h3>Configurazione iniziale</h3>\n<p>Per prima cosa si impostano delle variabili con i link ai tool necessari per la creazione dell’emulatore. In particolare la JDK di Java per la compilazione del codice necessario e i command line tools di Android che sono disponibili nella pagina di download di Android Studio e in particolare sulle opzioni di download.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Variables</span>\n<span class=\"token variable\">$jdkVersion</span> = <span class=\"token string\">\"jdk-18.0.2.1\"</span>\n<span class=\"token variable\">$commandLineTool</span> = <span class=\"token string\">\"commandlinetools-win-11076708\"</span>\n<span class=\"token variable\">$jdkUrl</span> = <span class=\"token string\">\"https://download.oracle.com/java/18/archive/\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$jdkVersion</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"_windows-x64_bin.zip\"</span>\n<span class=\"token variable\">$commandLineToolsUrl</span> = <span class=\"token string\">\"https://dl.google.com/android/repository/\"</span> <span class=\"token operator\">+</span> <span class=\"token variable\">$commandLineTool</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"_latest.zip?hl=it\"</span>\n\n<span class=\"token variable\">$systemImage</span> = <span class=\"token string\">\"android-29\"</span>\n<span class=\"token variable\">$phoneName</span> = <span class=\"token string\">\"android29\"</span>\n<span class=\"token variable\">$device</span> = <span class=\"token string\">\"pixel_3a\"</span></code></pre></div>\n<h3>Costruzione dell’alberatura</h3>\n<p>Lo script poi si preoccupa di avere la struttura di base come segue:</p>\n<div class=\"gatsby-highlight\" data-language=\"prompt\"><pre class=\"language-prompt\"><code class=\"language-prompt\">create-emulator.ps1\n├── output\n│   ├── avd\n│   ├── cmdline-tools          \n│   ├── platform-tools\n│   ├── platforms</code></pre></div>\n<p>Il pezzo dedicato è il seguente:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Directory whose contents need to be deleted</span>\n<span class=\"token variable\">$currentDirectory</span> = <span class=\"token variable\">$PWD</span><span class=\"token punctuation\">.</span>Path\n<span class=\"token variable\">$outputDir</span> = <span class=\"token string\">\"<span class=\"token variable\">$currentDirectory</span>\\output\"</span>\n\n<span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* Start creating the emulator...\"</span>\n\n<span class=\"token comment\"># Crea la directory principale</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$outputDir</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>ItemType Directory <span class=\"token operator\">-</span>Path <span class=\"token variable\">$outputDir</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span> created\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$outputDir</span> already exists\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># Create the subfolders</span>\n<span class=\"token variable\">$platformsPath</span> = <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\platforms\"</span>\n<span class=\"token variable\">$platformToolsPath</span> = <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\platform-tools\"</span>\n<span class=\"token variable\">$avdPath</span> = <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\avd\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$platformsPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>ItemType Directory <span class=\"token operator\">-</span>Path <span class=\"token variable\">$platformsPath</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$platformsPath</span> created\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$platformsPath</span> already exists\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$platformToolsPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>ItemType Directory <span class=\"token operator\">-</span>Path <span class=\"token variable\">$platformToolsPath</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$platformToolsPath</span> created\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$platformToolsPath</span> already exists\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$avdPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>ItemType Directory <span class=\"token operator\">-</span>Path <span class=\"token variable\">$avdPath</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$avdPath</span> created\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$avdPath</span> already exists\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A questo punto scarichiamo e installiamo i tools e la JDK</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Manage command line tool</span>\n<span class=\"token variable\">$commandLineToolsPath</span> = <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\cmdline-tools\"</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$commandLineToolsPath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$latestFolder</span> = <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\latest\"</span>\n\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* Extract commandlinetools. This will create <span class=\"token variable\">$commandLineToolsPath</span>\"</span>\n    <span class=\"token function\">Expand-Archive</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$zipFilePath</span> <span class=\"token operator\">-</span>DestinationPath <span class=\"token variable\">$outputDir</span>\n    \n    <span class=\"token function\">Rename-Item</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$commandLineToolsPath</span> <span class=\"token operator\">-</span>NewName <span class=\"token variable\">$latestFolder</span> <span class=\"token operator\">-</span>Force <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$commandLineToolsPath</span> renamed in <span class=\"token variable\">$latestFolder</span>\"</span>\n\n    <span class=\"token function\">New-Item</span> <span class=\"token operator\">-</span>ItemType Directory <span class=\"token operator\">-</span>Path <span class=\"token variable\">$commandLineToolsPath</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-Null</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$commandLineToolsPath</span> recreated\"</span>\n\n    <span class=\"token function\">Move-Item</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$latestFolder</span> <span class=\"token operator\">-</span>Destination <span class=\"token variable\">$commandLineToolsPath</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"- <span class=\"token variable\">$latestFolder</span> moved into <span class=\"token variable\">$commandLineToolsPath</span>\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* Command line tools already exists\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$zipFilePath</span> = <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\jdk-18.0.2.1_windows-x64_bin.zip\"</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token variable\">$zipFilePath</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* Download JDK\"</span>\n    <span class=\"token function\">Invoke-WebRequest</span> <span class=\"token operator\">-</span>Uri <span class=\"token variable\">$jdkUrl</span> <span class=\"token operator\">-</span>OutFile <span class=\"token variable\">$zipFilePath</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* JDK zip already exists\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\<span class=\"token variable\">$jdkVersion</span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* Extract JDK\"</span>\n    <span class=\"token function\">Expand-Archive</span> <span class=\"token operator\">-</span>Path <span class=\"token variable\">$zipFilePath</span> <span class=\"token operator\">-</span>DestinationPath <span class=\"token variable\">$outputDir</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* JDK already exists\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Salviamoci le precedenti variabili di ambiente e impostiamo quelle nuove</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># Backup ENV values</span>\n<span class=\"token variable\">$oldAvdHome</span> = <span class=\"token variable\">$env</span>:ANDROID_AVD_HOME\n<span class=\"token variable\">$oldSdkHome</span> = <span class=\"token variable\">$env</span>:ANDROID_SDK_HOME\n<span class=\"token variable\">$oldSdkRoot</span> = <span class=\"token variable\">$env</span>:ANDROID_SDK_ROOT\n<span class=\"token variable\">$oldJavaHome</span> = <span class=\"token variable\">$env</span>:JAVA_HOME\n<span class=\"token variable\">$oldTimeout</span> = <span class=\"token variable\">$env</span>:ANDROID_EMULATOR_WAIT_TIME_BEFORE_KILL\n\n<span class=\"token variable\">$env</span>:ANDROID_AVD_HOME = <span class=\"token variable\">$avdPath</span>\n<span class=\"token variable\">$env</span>:ANDROID_SDK_HOME = <span class=\"token variable\">$outputDir</span>\n<span class=\"token variable\">$env</span>:ANDROID_SDK_ROOT = <span class=\"token variable\">$outputDir</span>\n<span class=\"token variable\">$env</span>:JAVA_HOME = <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\<span class=\"token variable\">$jdkVersion</span>\"</span>\n<span class=\"token variable\">$env</span>:ANDROID_EMULATOR_WAIT_TIME_BEFORE_KILL = 5</code></pre></div>\n<p>Segue il lavoro sporco… installare il tutto. Il consiglio è di accettare i vari termini di utilizzo e di non impostare a mano le liriadi di impostazioni dell’emulatore. Invece presettiamo un device specifico per semplificarci la vita. nel mio caso un pixel_3a.</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-not</span> <span class=\"token punctuation\">(</span><span class=\"token function\">Test-Path</span> <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\system-images\\<span class=\"token variable\">$systemImage</span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* Install the system image and the platform\"</span>\n    <span class=\"token function\">Start-Process</span> <span class=\"token operator\">-</span>FilePath <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\cmdline-tools\\latest\\bin\\sdkmanager.bat\"</span> <span class=\"token operator\">-</span>ArgumentList <span class=\"token string\">\"--install\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"system-images;<span class=\"token variable\">$systemImage</span>;google_apis;x86_64\"</span> <span class=\"token operator\">-</span>NoNewWindow <span class=\"token operator\">-</span>Wait\n    <span class=\"token function\">Start-Process</span> <span class=\"token operator\">-</span>FilePath <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\cmdline-tools\\latest\\bin\\sdkmanager.bat\"</span> <span class=\"token operator\">-</span>ArgumentList <span class=\"token string\">\"platform-tools platforms;<span class=\"token variable\">$systemImage</span>\"</span> <span class=\"token operator\">-</span>NoNewWindow <span class=\"token operator\">-</span>Wait\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* System image and platform already exists\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Eseguiamo l’emulatore</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># start the emulator</span>\n<span class=\"token function\">Write-Host</span> <span class=\"token string\">\"* Launch the emulator\"</span>\n<span class=\"token function\">Start-Process</span> <span class=\"token operator\">-</span>FilePath <span class=\"token string\">\"<span class=\"token variable\">$outputDir</span>\\emulator\\emulator.exe\"</span> <span class=\"token operator\">-</span>ArgumentList <span class=\"token string\">\"-avd <span class=\"token variable\">$phoneName</span> -qemu -m 3000\"</span> <span class=\"token operator\">-</span>NoNewWindow <span class=\"token operator\">-</span>Wait\n</code></pre></div>\n<p>Ripristiniamo le variabili ambiente</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$env</span>:ANDROID_AVD_HOME = <span class=\"token variable\">$oldAvdHome</span>\n<span class=\"token variable\">$env</span>:ANDROID_SDK_HOME = <span class=\"token variable\">$oldSdkHome</span>\n<span class=\"token variable\">$env</span>:ANDROID_SDK_ROOT = <span class=\"token variable\">$oldSdkRoot</span>\n<span class=\"token variable\">$env</span>:JAVA_HOME = <span class=\"token variable\">$oldJavaHome</span>\n<span class=\"token variable\">$env</span>:ANDROID_EMULATOR_WAIT_TIME_BEFORE_KILL = <span class=\"token variable\">$oldTimeout</span></code></pre></div>\n<h2>🍷 Conclusione</h2>\n<p>Lo script permette con poco sforzo di ottenere un emulatore. Quello che però può essere un punto di attenzione è la fase di build dell’APK che si vuole testare. Il sistema appena descritto si aspetta una compilazione per x86_64 ma questa potrebbe non essere disponibile se l’APK viene compilata solo per ARM. Per il resto è stato un bel esercizio di stile e mi ha fatto comprendere la complessità che c’è dietro al processo di build e debug di uno sviluppo nativo per Android.</p>\n<h2>🔗 Link utili</h2>\n<ul>\n<li><a href=\"https://www.wrike.com/blog/how-to-create-an-android-emulator-terminal/\">How to create an Android emulator terminal</a></li>\n<li><a href=\"https://community.neptune-software.com/topics/tips--tricks/blogs/how-to-install--android-emulator-without--android--st\">How to install Android emulator without Android Studio</a></li>\n<li><a href=\"https://medium.com/@yohan.ardiansyah90/how-to-run-android-emulator-for-development-without-android-studio-f0e73682af3a\">How to run Android emulator for development without Android Studio</a></li>\n<li><a href=\"https://stackoverflow.com/questions/61595161/emulator-panic-broken-avd-system-path-check-your-android-sdk-root-value-f-a\">Emulator Panic Broken Avd</a></li>\n</ul>\n<blockquote>\n<p>“Se l’opportunità non bussa, costruisciti una porta.”. (Milton Berle)</p>\n</blockquote>","frontmatter":{"title":"Come costruirsi un Emulatore Android senza Android Studio","date":"01 June 2024","description":null,"tags":["Software"]}},"previous":{"fields":{"slug":"/2024-04-01-buchi-bianchi/"},"frontmatter":{"title":"Buchi Bianchi (Carlo Rovelli)"}},"next":{"fields":{"slug":"/2024-08-01-from-zero-to-ai/"},"frontmatter":{"title":"Zero to AI A non-technical, hype-free guide to prospering in the AI era (Nicolò Valigi, Gianluca Mauro)"}}},"pageContext":{"id":"a593d3bb-4d74-51cc-b7f3-cd818a301b6d","previousPostId":"1d26f0ad-7df0-5453-a8e8-af0c0b563ade","nextPostId":"5c89c8a1-a9ff-5805-8f49-37ae290be1ab"}},"staticQueryHashes":["2114561082"],"slicesMap":{}}