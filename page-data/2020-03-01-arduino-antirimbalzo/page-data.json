{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-03-01-arduino-antirimbalzo/","result":{"data":{"site":{"siteMetadata":{"title":"Capitanfuturo"}},"markdownRemark":{"id":"fc3222a1-e7c6-5508-9954-3909053f009f","excerpt":"üíª Introduzione Aggiungere un pulsante al proprio progetto Arduino pu√≤ sembrare la cosa pi√π semplice da realizzare, ma se al posto di un pulsante si vuole‚Ä¶","html":"<h2>üíª Introduzione</h2>\n<p>Aggiungere un pulsante al proprio progetto Arduino pu√≤ sembrare la cosa pi√π semplice da realizzare, ma se al posto di un pulsante si vuole realizzare un interruttore la cosa si fa leggermente pi√π complicata. In questo articolo parliamo della funzione di anti-rimbalzo da applicare per ottenere un interruttore.\nUn pulsante √® un contatto Normalmente Aperto (N.O.) che √® aperto a riposo e nel momento in cui viene premuto chiude il circuito permettendo alla corrente di scorrere sul circuito.\nNella teoria un pulsante apre e chiude istantaneamente il circuito ma nella realt√† esiste un piccolo transitorio</p>\n<p>Se usiamo il pulsante quando √® premuto per accendere una lampada e quando lo rilasciamo vogliamo che la lampada si spenga siamo nel caso in un utilizzo monostabile, ed in questo caso il fenomeno di microbalzo del pulsante √® trascurabile. Se invece vogliamo che il pulsante si comporti come un interruttore che alla prima pressione accenda il led e alla seconda pressione lo spenga allora siamo di fronte ad un caso di utilizzo bistabile ed in questo caso dovremmo armarci di una funzione di antirimbalzo per garantire uno stato stabile di accensione o spegnimento del led comandato.</p>\n<h2>Circuito</h2>\n<p>Il circuito per realizzare un pulsante bistabile con Arduino √® riportato qui sotto. Le resistenze sono state messe per garantire che il LED non si bruciasse come detto nei primi articoli sui LED.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 557px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ab5a38a119c5178f050eca7bdb0d361/30d00/circuito.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 115.18987341772151%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEqElEQVR42nWUiU9URxzH+T+aNGmapq01SmpTtUYFlWpbe4ihiJVK1GBBwAOkaKtirYsHoFauouCBZyrLZQFBBVGOvd6eLIuylHLILmBQZFdOP523iHURX/LNzPzevM98fzO/Nz6DLjeTevxkgI7OLtra2+nqfEh3l4N/O9pp7+h8oQ4xfl1tYk5HV5fne58JmAvXsyEcDid6rQajRktV7S3Ka0ox6/ToNRoMWq2n1WvUnlZSq71k0GlxOnsmgW5c7iGcAmjW67Gbmrh66zJpJSc9fYNYxKTTvZRRwI3yIhrNRCuAcrynp3cC+HTQhVs47O52oJMkJAGVJANarQ690YjBYED/Qp53b5DT6fQGPnzYjSQ7MJnQqeuoqb6N2WzxAM1mM0YZLj6Uxx7J/ReShBGHw/FKyrJDEWhstHC/pRVNpZI7pfmib+d+czNZWVncrLxJS0sLVquVpqYmL8kx+Qy8HYqU5ZVMJjOq2rvcqZpwaBKOy8rLuCdicv+lw1ekFy4d06WsEykb5PRu36a2qgqTxYzZYEIya1CZ1RgNxjcDpzqUD8ViNtFos2GSgUKWJpGe0UJD2VXuVl6i0WLzAOT9nNQk9LWykS1rRBnoxEttaSk1FRWevqRSU1V8gaqbRei0EhpRJvK8iVaNWqXyHObLshl46mJg0E1v3yNqC4vQ1tXTXF2NtUGFRQCtkp579TeEUzMWnUSjGDeJ+P/SYxN729fbh4+c7sjIMOOjI8jP41Y7zrY2ePSIcbfbExsdH8U55GTyGRsbExk989Jkpj5DQ0NomtspVdu4IT2guk7LuYzTFF8tQllUTn55DRdvVJD393WUZTVcLqmkqkHvBXlVPs/Hxzh67S7n0jL4Mekii7efwH/lBhavjWXOugR8Q3biu34P88J282noLnyDYwndl0m/2CaXyODpVOAz9yB5FWoUOQWs2H2W92LOEBCTyarYk3ypULJKcY2gQ/kEHy0kJLmQgH1X2PDHdfoHBqd16dMm9stut9MprqANx5TM3HiIReFJBP10kKiMYrJL6ohKL+bzX88TePAKi3bmsPrABaz/dDI8POwpOS+g3d6KTdRde+sDQlOUvPNNFHPWbCMoOpVl29P4av8lFsXn8vHWP/lkWzbzd5wiYHculVob42OjngrxTtk1yAnlHTHpDN/tz+NCRQPHCu6xNOIY88MUfBh9mlnR2cyOOeWR79bTvBueTkGtFVEaPJkKhOcknKnk7R8U+P+cS9SRs4QlnWdBdBpfhMQxNzKF+UJzI5OZJ9oFW1KYFZ5CUf0bgWMcLtTy9eZdLI/P5K2Q33k/7DCz1sQROHcO/n5+LBTy8/dn8ZIl+C38jNnLQyiob54e2Nfbw/p4BfOCIvDbcpjIk4XEpv3F2r3prFi9icDgjQRGJBAQGsPKTXGsDo9l6ea9lKhswss0QKO4nj6Y8REzZs5k4feb2ZGcw8bEdALjxR5GHufbsF9YtjOD2VvSWRKbybK4LIJ/y0VttTM6MiJ+2SnAx/39JGXmsS4hlQM5+ew7X8761EIiFNlsS0whfn8qWxOTiTmay/YDx4nac4TEjEv0PRE31DSF/R8a7NS0xUcuawAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"circuito\"\n        title=\"\"\n        src=\"/static/4ab5a38a119c5178f050eca7bdb0d361/30d00/circuito.png\"\n        srcset=\"/static/4ab5a38a119c5178f050eca7bdb0d361/c26ae/circuito.png 158w,\n/static/4ab5a38a119c5178f050eca7bdb0d361/6bdcf/circuito.png 315w,\n/static/4ab5a38a119c5178f050eca7bdb0d361/30d00/circuito.png 557w\"\n        sizes=\"(max-width: 557px) 100vw, 557px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Funzione di anti-rimbalzo</h2>\n<p>Per poter controllare in maniera efficace lo stato del pulsante l‚Äôidea di base √® quella di mettere un semaforo a codice e di salvare lo stato del pulsante solo nel caso sia passato un tempo adeguato per poter garantire che sia terminato il periodo del microbalzo del pulsante.</p>\n<p>Andiamo a leggere il valore del pulsante e lo confrontiamo con una guardia, se il valore cambia allora ci predisponiamo ad attendere un tempo adeguato prima di aggiornare lo stato del LED e di pilotarlo dall‚Äôuscita digitale agganciata.</p>\n<p>Il cuore del codice lo riporto qui sotto:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> buttonValue <span class=\"token operator\">=</span> <span class=\"token function\">digitalRead</span><span class=\"token punctuation\">(</span>BUTTON_PIN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// leggiamo lo stato del pulsante</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>buttonValue <span class=\"token operator\">!=</span> lastButtonValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">// se lo stato del pin √® variato</span>\n    debounceTime <span class=\"token operator\">=</span> <span class=\"token function\">millis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// tengo in memoria l'orario del cambio di stato del pulsante</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">millis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> debounceTime<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> WAIT_FOR_DEBOUNCE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">// se √® passato un tempo minimo dall'ultimo cambio di stato</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>buttonValue <span class=\"token operator\">!=</span> buttonStatus <span class=\"token operator\">&amp;&amp;</span> buttonValue <span class=\"token operator\">==</span> HIGH<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">// se il pin del pulsante ha un valore diverso dalla variabile di stato</span>\n        ledStatus <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>ledStatus<span class=\"token punctuation\">;</span> <span class=\"token comment\">// cambio lo stato del led</span>\n        <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>LED_PIN<span class=\"token punctuation\">,</span> ledStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    buttonStatus <span class=\"token operator\">=</span> buttonValue<span class=\"token punctuation\">;</span> <span class=\"token comment\">// assegno lo stato del pulsante con il nuovo valore</span>\n<span class=\"token punctuation\">}</span>\nlastButtonValue <span class=\"token operator\">=</span> buttonValue<span class=\"token punctuation\">;</span> <span class=\"token comment\">// assegno all'ultimo valore del pulsante lo stato</span>\n<span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ritardo</span></code></pre></div>\n<p>se volete il progetto intero √® disponibile sul mio repository github qui: <a href=\"https://github.com/capitanfuturo/arduinoSalad/blob/master/005_button_debounce_led/005_button_debounce_led.ino\">https://github.com/capitanfuturo/arduinoSalad/blob/master/005_button_debounce_led/005_button_debounce_led.ino</a>.</p>\n<h2>Considerazioni</h2>\n<p>Questo esercizio mi ha fatto capire come a differenza della programmazione ad alto livello, quando si ha a che fare con componenti fisici a basso livello, il programmatore debba tenere conto degli aspetti tecnici e di latenza di alcuni componenti analogici.\nIn un software non ci si immaginerebbe mai di aggiungere dei delay perch√® concorrenza e schedulazione sono gestiti a livelli pi√π bassi. Con Arduino invece, e con componenti analogici la lettura delle schede tecniche di ogni singolo componente, anche del semplice pulsante sono necessasri per il corretto funzionamento del progetto.</p>\n<p><img src=\"/55c4aabd0b7acd7241ecc3f24407e6ad/pulsante.gif\" alt=\"pulsante\"></p>\n<blockquote>\n<p>Il Buddha, il Divino, dimora nel circuito di un calcolatore o negli ingranaggi del cambio di una moto con lo stesso agio che in cima a una montagna o nei petali di un fiore. (Carl Gustav Jung)</p>\n</blockquote>","frontmatter":{"title":"Arduino e pulsanti bistabili. La funzione di anti-rimbalzo","date":"01 March 2020","description":null,"tags":["Arduino"]}},"previous":{"fields":{"slug":"/2020-02-15-arduino-shift-register-SN74HC595N/"},"frontmatter":{"title":"Arduino e il registro a scorrimento SN74HC595N"}},"next":{"fields":{"slug":"/2020-03-15-domain-driven-design-distilled/"},"frontmatter":{"title":"Domain-Driven Design Distilled. (Vaughn Vernon)"}}},"pageContext":{"id":"fc3222a1-e7c6-5508-9954-3909053f009f","previousPostId":"973ffed5-cab1-505e-a894-e19e61c9c1b0","nextPostId":"0b1eec09-52bd-59c9-a18c-7234564b7f6b"}},"staticQueryHashes":["2114561082"],"slicesMap":{}}