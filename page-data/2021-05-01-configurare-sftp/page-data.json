{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021-05-01-configurare-sftp/","result":{"data":{"site":{"siteMetadata":{"title":"Capitanfuturo"}},"markdownRemark":{"id":"00694712-7b50-5ac2-82c0-940c2a3c6254","excerpt":"üíª Introduzione In questo articolo voglio annotarmi quello che ho imparato configurando un server SFTP Linux per permettere l‚Äôaccesso ad utenze diverse. So che‚Ä¶","html":"<h2>üíª Introduzione</h2>\n<p>In questo articolo voglio annotarmi quello che ho imparato configurando un server SFTP Linux per permettere l‚Äôaccesso ad utenze diverse. So che non √® qualcosa di entusiasmante per√≤ conoscendomi preferisco scrivere per non dimenticarmi.</p>\n<h2>Prerequisiti e assunzioni</h2>\n<p>Prima di iniziare utile fare delle assunzioni sull‚Äôambiente e sui requisiti:</p>\n<ul>\n<li>Avere a disposizione un <strong>server Linux</strong></li>\n<li>Avere installato un <strong>server SSH</strong>. Ad esempio il pacchetto <code class=\"language-text\">openssh-server</code></li>\n<li>Conoscere l‚Äôutenza di <strong>root</strong></li>\n<li>Assumiamo che la directory che conterr√† i contenuti FTP sia <code class=\"language-text\">/home/sftp</code></li>\n<li>Assumiamo che il gruppo Linux per gli utenti che accederanno alla directory precedente sia chiamato <code class=\"language-text\">ftpusers</code></li>\n<li><strong>Gli utenti non possono navigare in qualunque directory</strong></li>\n<li>Si vuole che un web server possa scrivere sulle directory degli utenti</li>\n</ul>\n<h2>Aggiungere il gruppo per gli utenti FTP</h2>\n<p>Aggiungiamo il gruppo con il comando:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">groupadd</span> sftpusers</code></pre></div>\n<p>e creaiamo la directory target:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /home/sftp</code></pre></div>\n<h2>Configurare il server SSH</h2>\n<p>L‚Äôidea di base nella configurazione del server SSH √® quello di attivare il sistema <code class=\"language-text\">internal-sftp</code> e aggiungere delle regole di accesso per gli uteni. La prima configurazione permette di forzare il comando impostato in ForceCommand, ignorando qualunque altro comando impostato dal client in connessione per questioni di sicurezza mentre la seconda configurazione isola l‚Äôutente a navigare solo nella sua directory principale che vedr√† come la direcotry di root.</p>\n<p>Per fare questo dobbiamo modificare le sezioni seguenti del file <code class=\"language-text\">/etc/ssh/sshd_config</code> :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">#Subsystem      sftp    /usr/libexec/openssh/sftp-server</span>\nSubsystem       <span class=\"token function\">sftp</span>    internal-sftp\n\n<span class=\"token punctuation\">..</span>.\n\nMatch Group sftpusers\n        ChrootDirectory /home/sftp/%u\n        ForceCommand internal-sftp\n        X11Forwarding no\n        AllowTcpForwarding no</code></pre></div>\n<p>Una volta modificato il file di configurazione del server SSH possiamo provare la sintatti del file con il comando :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">sshd <span class=\"token parameter variable\">-t</span></code></pre></div>\n<p><strong>NOTA</strong>: Se si applicano le modifiche senza controllare prima eventuali errori si rischia di essere disconnessi dal server senza potervi pi√π accedere via SSH.</p>\n<p>Bene, una volta controllato il tutto possiamo riavviare il servizio SSH.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">service</span> sshd restart</code></pre></div>\n<h2>Aggiungere un utente SFTP</h2>\n<p>Una volta configurato il server SSH vediamo come aggiungere gli utenti che utilizzeranno il servizio SFTP.Per prima cosa aggiungiamo un nuovo utente chiamato nomeUtente senza il supporto alla login da terminale.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">useradd</span> <span class=\"token parameter variable\">-g</span> ftpusers <span class=\"token parameter variable\">-d</span> /incoming <span class=\"token parameter variable\">-s</span> /sbin/nologin nomeUtente</code></pre></div>\n<p>Impostiamo una password</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">passwd</span> nomeUtente</code></pre></div>\n<p>Controlliamo che tutto torni. Dovremmo vedere un risultato de genere al comando <code class=\"language-text\">grep nomeUtente /etc/passwd</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">nomeUtente‚ùå500:500::/incoming:/sbin/nologin</code></pre></div>\n<p>Creaiamo la directory per nuovoUtente con i permessi di scrittura per il nostro web server che scriver√† sulla directory <code class=\"language-text\">incoming</code> dell‚Äôutente appena creato.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /home/sftp/nomeUtente/incoming\n<span class=\"token function\">chown</span> nomeUtente:ftpusers /home/sftp/nomeUtente\n<span class=\"token function\">chmod</span> <span class=\"token number\">766</span> /home/sftp/nomeUtente/incoming</code></pre></div>\n<h2>Conclusione</h2>\n<p>Configurare un server SFTP pu√≤ richiedere qualche accortezza ma permette di dare ai propri utenti un servizio largamente usato specialmente in mabito legacy e per comunicazioni di file M2M machine 2 machine.</p>\n<blockquote>\n<p>Ho scoperto che imparo sempre pi√π dai miei errori che dai miei successi. Se non fai degli sbagli, non stai cogliendo abbastanza opportunit√†. (John Sculley)</p>\n</blockquote>","frontmatter":{"title":"Configurare un server SFTP per condividere contenuti","date":"01 May 2021","description":null,"tags":["ComputerScience"]}},"previous":{"fields":{"slug":"/2021-04-15-nessun-pasto-e-gratis/"},"frontmatter":{"title":"Nessun pasto √® gratis (Lorenzo Forni)"}},"next":{"fields":{"slug":"/2021-05-15-storia-dell-economia/"},"frontmatter":{"title":"Storia dell'economia (John Kenneth Galbraith)"}}},"pageContext":{"id":"00694712-7b50-5ac2-82c0-940c2a3c6254","previousPostId":"e823b567-6df1-57d9-bb62-e2551a118764","nextPostId":"68fd5386-4447-5934-a07c-5d5c8ecf6a36"}},"staticQueryHashes":["2114561082"],"slicesMap":{}}